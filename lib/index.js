!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(t=t||self)["canvas-slide-calculator"]=i()}(this,function(){"use strict";function s(t,i){for(var e=0;e<i.length;e++){var s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(){function h(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,h);var i=document.querySelector(t.element);this.element=i;var e=t.width,s=t.height;this.ctx=i.getContext("2d"),this.onSelect=t.onSelect,this.data=t.data,this.devicePixelRatio=window.devicePixelRatio,i.style.width="".concat(e,"px"),i.style.height="".concat(s,"px"),this.width=e*this.devicePixelRatio,this.height=s*this.devicePixelRatio,i.width=this.width,i.height=this.height,this.bottomLineHeight=.81*this.height,this.offsetX=0,this.press=!1,this.vx=0,this.scrollDistance=0,this.columnLen=t.data.length-1,this.columnWidth=Math.ceil(this.width/5),this.columnItemWidth=this.columnWidth/10,this.ctx.lineWidth=1*this.devicePixelRatio}var t,i,e;return t=h,(i=[{key:"drawTargetArrow",value:function(){var t=this.width/2,i=.3*this.height;this.ctx.strokeStyle="rgb(222, 222, 222)",this.ctx.beginPath(),this.ctx.moveTo(0,this.bottomLineHeight),this.ctx.lineTo(this.width,this.bottomLineHeight),this.ctx.closePath(),this.ctx.stroke(),this.ctx.strokeStyle="rgb(73, 128, 219)",this.ctx.beginPath(),this.ctx.moveTo(t,this.bottomLineHeight),this.ctx.lineTo(t,i),this.ctx.closePath(),this.ctx.stroke(),this.ctx.fillStyle="rgb(73, 128, 219)";var e=.02*this.width,s=.70711*e;this.ctx.beginPath(),this.ctx.moveTo(t-e/2+this.ctx.lineWidth/2,i),this.ctx.lineTo(t+s/2+this.ctx.lineWidth/2,i),this.ctx.lineTo(t,i-s),this.ctx.closePath(),this.ctx.fill()}},{key:"draw",value:function(){this.drawTargetArrow(),this.drawScale()}},{key:"drawScale",value:function(){var t=this.width/2,i=.0267*this.width,e=.0133*this.width,s=this.columnWidth*this.columnLen;this.ctx.save();var h=this.offsetX;this.ctx.translate(t,this.bottomLineHeight),this.ctx.strokeStyle="rgb(222, 222, 222)",this.ctx.globalCompositeOperation="destination-over";for(var o=h;o<=s+h;o+=this.columnWidth){this.ctx.beginPath(),this.ctx.moveTo(o,0),this.ctx.lineTo(o,0-i),this.ctx.closePath(),this.ctx.stroke(),this.ctx.textAlign="center",this.ctx.font="".concat(.033*this.width,"px sans-serif"),this.ctx.fillStyle="rgb(222, 222, 222)";var n=Math.ceil((-h+o)/this.columnWidth),c=this.data[n];this.ctx.fillText(c,o,-i-.0133*this.width);var l=Math.round(-h/this.columnWidth);-h>this.columnWidth*this.columnLen&&(l=this.columnLen),this.onSelect&&this.onSelect(this.data[l]);for(var a=o;a<o+this.columnWidth;a+=this.columnItemWidth)-h+a<=s&&(this.ctx.beginPath(),this.ctx.moveTo(a,0),this.ctx.lineTo(a,0-e),this.ctx.closePath(),this.ctx.stroke())}}},{key:"bindEvent",value:function(){var s=0,h=this,e=null;this.element.addEventListener("touchstart",function(t){h.press=!0,e=(new Date).getTime(),h.scrollDistance=0,h.vx=0;var i=t.targetTouches[0];s=i.pageX,t.preventDefault()}),this.element.addEventListener("touchmove",function(t){h.press=!0;var i=t.targetTouches[0],e=i.pageX-s;h.offsetX=h.offsetX+e*h.devicePixelRatio,h.scrollFlag||(0<e&&h.offsetX>.1*h.width?h.offsetX=.1*h.width:e<0&&h.offsetX<-h.columnWidth*h.columnLen-.1*h.width&&(h.offsetX=-h.columnWidth*h.columnLen-.1*h.width)),s=i.pageX,h.vx=e,t.preventDefault()}),this.element.addEventListener("touchend",function(t){h.press=!1;var i=(new Date).getTime()-e;i<250?(h.vx<-0?(h.scrollDistance=-h.columnWidth*h.columnLen*10*h.devicePixelRatio/i,h.scrollDistance+h.offsetX<-h.columnWidth*h.columnLen-.1*h.width&&(h.scrollDistance=-h.columnWidth*h.columnLen-.1*h.width-h.offsetX)):0<h.vx&&(h.scrollDistance=h.columnWidth*h.columnLen*10*h.devicePixelRatio/i,h.scrollDistance+h.offsetX>.1*h.width&&(h.scrollDistance=.1*h.width-h.offsetX)),h.scrollFlag=!0):h.scrollFlag=!1,t.preventDefault()})}},{key:"adjustPosition",value:function(){var t=Math.round(-this.offsetX/this.columnWidth),i=t*this.columnWidth,e=null;if(t<0){var s=(e=Math.abs(-this.offsetX-0))/5;this.offsetX=this.offsetX-s}else if(t>this.columnLen){var h=(e=Math.abs(-this.offsetX-this.columnWidth*this.columnLen))/5;this.offsetX=this.offsetX+h}else{var o=(e=Math.abs(-this.offsetX-i))/5;i>-this.offsetX?this.offsetX=this.offsetX-o:this.offsetX=this.offsetX+o}e<1&&(this.offsetX=-t*this.columnWidth,this.press=!0)}},{key:"scrollMove",value:function(){var t=this.scrollDistance/10;this.scrollDistance=this.scrollDistance-t,this.offsetX=this.offsetX+t,Math.abs(this.scrollDistance)<1&&(this.scrollFlag=!1)}},{key:"render",value:function(){var t=this;setInterval(function(){t.ctx.clearRect(0,0,t.width,t.height),t.draw(),t.ctx.restore(),t.scrollFlag&&t.scrollMove(),!t.press&&!t.scrollFlag&&t.adjustPosition()},1e3/60),this.bindEvent()}}])&&s(t.prototype,i),e&&s(t,e),h}()});
